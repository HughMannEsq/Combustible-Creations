@page
@model AutumnRidgeUSA.Pages.Admin.ImportExcelModel
@{
    ViewData["Title"] = "Import Excel Data";
}

<h2>Import Client Data from Excel</h2>

<div class="import-container">
    <div class="import-instructions">
        <h3>Excel File Requirements</h3>
        <ul>
            <li>File must be in .xlsx or .xls format</li>
            <li>First row should contain column headers</li>
            <li>Required columns: Email, FirstName, LastName</li>
            <li>Optional columns: Phone, Address, City, State, ZipCode, Divisions, Balance</li>
            <li>Divisions should be comma-separated (e.g., "Storage, Real Estate")</li>
        </ul>
    </div>

    @if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert @(Model.IsSuccess ? "alert-success" : "alert-danger")">
            @Model.StatusMessage
        </div>
    }

    @if (Model.ImportResult != null)
    {
        <div class="import-results">
            <h3>Import Results</h3>
            <div class="result-summary">
                <div class="result-item success">
                    <span class="result-label">Successful:</span>
                    <span class="result-value">@Model.ImportResult.SuccessCount</span>
                </div>
                <div class="result-item failure">
                    <span class="result-label">Failed:</span>
                    <span class="result-value">@Model.ImportResult.FailureCount</span>
                </div>
            </div>

            @if (Model.ImportResult.Warnings.Any())
            {
                <div class="result-section warnings">
                    <h4>Warnings</h4>
                    <ul>
                        @foreach (var warning in Model.ImportResult.Warnings.Take(10))
                        {
                            <li>@warning</li>
                        }
                        @if (Model.ImportResult.Warnings.Count > 10)
                        {
                            <li><em>... and @(Model.ImportResult.Warnings.Count - 10) more warnings</em></li>
                        }
                    </ul>
                </div>
            }

            @if (Model.ImportResult.Errors.Any())
            {
                <div class="result-section errors">
                    <h4>Errors</h4>
                    <ul>
                        @foreach (var error in Model.ImportResult.Errors)
                        {
                            <li>@error</li>
                        }
                    </ul>
                </div>
            }
        </div>
    }

    <div class="upload-section">
        <form method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="excelFile">Select Excel File</label>
                <input type="file" id="excelFile" name="excelFile" accept=".xlsx,.xls" required class="form-control-file" />
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" name="updateExisting" value="true" />
                    Update existing clients (match by email)
                </label>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" name="testMode" value="true" />
                    Test mode (preview without saving)
                </label>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-primary">
                    <span id="uploadText">Upload and Import</span>
                    <span id="uploadSpinner" style="display: none;">
                        <i class="spinner"></i> Processing...
                    </span>
                </button>
                <a href="/Admin/Clients" class="btn btn-secondary">Back to Clients</a>
            </div>
        </form>
    </div>

    <div class="template-section">
        <h3>Download Template</h3>
        <p>Download an Excel template with the correct column headers:</p>
        <form method="post" asp-page-handler="DownloadTemplate">
            <button type="submit" class="btn btn-info">Download Excel Template</button>
        </form>
    </div>
</div>

<style>
    .import-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .import-instructions {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

        .import-instructions h3 {
            margin-top: 0;
            color: #1e3a5f;
        }

        .import-instructions ul {
            margin-bottom: 0;
        }

    .import-results {
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .result-summary {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .result-item {
        flex: 1;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
    }

        .result-item.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .result-item.failure {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

    .result-label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .result-value {
        display: block;
        font-size: 24px;
        font-weight: bold;
    }

    .result-section {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }

        .result-section.warnings {
            background: #fff3cd;
            border: 1px solid #ffeeba;
        }

        .result-section.errors {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .result-section h4 {
            margin-top: 0;
        }

    .upload-section {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 15px;
    }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

    .form-control-file {
        display: block;
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }

    .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .template-section {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 8px;
        padding: 20px;
    }

        .template-section h3 {
            margin-top: 0;
            color: #1565c0;
        }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        display: inline-block;
        transition: all 0.2s;
    }

    .btn-primary {
        background: #007bff;
        color: white;
    }

        .btn-primary:hover {
            background: #0056b3;
        }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

        .btn-secondary:hover {
            background: #545b62;
        }

    .btn-info {
        background: #17a2b8;
        color: white;
    }

        .btn-info:hover {
            background: #138496;
        }

    .alert {
        padding: 12px;
        margin: 15px 0;
        border-radius: 4px;
        border: 1px solid transparent;
    }

    .alert-success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
    }

    .alert-danger {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
    }

    .spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>

<script>
    document.querySelector('form').addEventListener('submit', function() {
        document.getElementById('uploadText').style.display = 'none';
        document.getElementById('uploadSpinner').style.display = 'inline';
    });
</script>

@* Code-behind file: ImportExcel.cshtml.cs *@