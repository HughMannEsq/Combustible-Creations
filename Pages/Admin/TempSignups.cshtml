@page
@model AutumnRidgeUSA.Pages.Admin.TempSignupsModel
@{
    ViewData["Title"] = "Temporary Signups - Admin";
}

<h2>Temporary Signups Management</h2>

@if (!string.IsNullOrEmpty(Model.StatusMessage))
{
    <div class="alert alert-info">
        @Model.StatusMessage
    </div>
}

<div style="margin-bottom: 20px;">
    <p><strong>Total pending signups:</strong> @Model.TempSignups.Count</p>
    <form method="post" asp-page-handler="CleanupExpired" style="display: inline;">
        <button type="submit" class="btn btn-warning" onclick="return confirm('Delete all expired signups?')">
            Clean Up Expired Records
        </button>
    </form>
</div>

<table id="tempSignupsTable" style="width: 100%; border-collapse: collapse;">
    <thead style="background-color: #f2f2f2;">
        <tr>
            <th style="border: 1px solid #ddd; padding: 8px;">Name</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Email</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Created</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Status</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var signup in Model.TempSignups)
        {
            <tr style="@(signup.IsExpired ? "background-color: #ffe6e6;" : "")">
                <td style="border: 1px solid #ddd; padding: 8px;">
                    @signup.FirstName @signup.LastName
                </td>
                <td style="border: 1px solid #ddd; padding: 8px;">
                    @signup.Email
                </td>
                <td style="border: 1px solid #ddd; padding: 8px;">
                    @signup.CreatedAt.ToString("MM/dd/yyyy HH:mm")
                </td>
                <td style="border: 1px solid #ddd; padding: 8px;">
                    @if (signup.IsExpired)
                    {
                        <span style="color: red; font-weight: bold;">EXPIRED</span>
                    }
                    else if (signup.IsAuthorized)
                    {
                        <span style="color: green; font-weight: bold;">AUTHORIZED</span>
                    }
                    else
                    {
                        <span style="color: orange;">
                            @signup.TimeRemaining
                        </span>
                    }
                </td>
                <td style="border: 1px solid #ddd; padding: 8px;">
                    @if (!signup.IsAuthorized)
                    {
                        <form method="post" asp-page-handler="Delete" style="display: inline;">
                            <input type="hidden" name="signupId" value="@signup.Id" />
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('Delete signup for @signup.Email?')">
                                Delete
                            </button>
                        </form>

                        @if (!signup.IsExpired)
                        {
                            <form method="post" asp-page-handler="ResendEmail" style="display: inline; margin-left: 5px;">
                                <input type="hidden" name="signupId" value="@signup.Id" />
                                <button type="submit" class="btn btn-primary btn-sm">
                                    Resend Email
                                </button>
                            </form>
                        }
                    }
                </td>
            </tr>
        }

        @if (!Model.TempSignups.Any())
        {
            <tr>
                <td colspan="5" style="border: 1px solid #ddd; padding: 20px; text-align: center; font-style: italic;">
                    No temporary signups found
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

    <style>
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
        }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-sm { font-size: 11px; padding: 3px 6px; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .alert-info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>

    <script>
        $(document).ready(function () {
            $('#tempSignupsTable').DataTable({
                "order": [[2, "desc"]], // Sort by Created date, newest first
                "pageLength": 25
            });
        });
    </script>
}